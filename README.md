# Генератор этикеток в PDF

Проект содержит два скрипта для генерации этикеток с DataMatrix кодами в PDF документы:

- **`main.py`** - оригинальный скрипт для генерации этикеток
- **`gen2.py`** - улучшенная версия с поддержкой шаблонов и многостраничных PDF

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/michaelbag/lg_html.git
cd lg_html
```

2. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate     # Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Структура проекта

```
lg_html/
├── main.py              # Оригинальный генератор этикеток
├── gen2.py              # Улучшенный генератор с шаблонами
├── requirements.txt     # Зависимости Python
├── README.md           # Этот файл
├── GEN2_USAGE.md       # Подробная документация gen2.py
├── example_gen2.py     # Примеры использования gen2.py
├── data.csv.example    # Пример CSV файла
└── .gitignore          # Исключения для Git
```

## Использование main.py

Оригинальный скрипт для генерации простых этикеток:

```bash
python main.py <csv_file> <output_pdf> [опции]
```

### Основные параметры:
- `csv_file` - путь к CSV файлу с данными
- `output_pdf` - путь к выходному PDF файлу
- `--dm-size` - размер DataMatrix кода в мм
- `--dm-x`, `--dm-y` - координаты DataMatrix
- `--dpi` - DPI для генерации (по умолчанию: 300)

### Пример:
```bash
python main.py data.csv.example output.pdf --dm-size 15 --dm-x 10 --dm-y 5
```

## Использование gen2.py

Улучшенный скрипт с поддержкой шаблонов и автоматической организацией файлов.

### Структура папок

Скрипт автоматически создает и использует папки:

- **`input_data/`** - CSV файлы с данными (разделитель - табуляция)
- **`input_templates/`** - PDF шаблоны для этикеток
- **`temp/`** - временные файлы (создаются и удаляются автоматически)
- **`output/`** - готовые PDF файлы с этикетками

### Быстрый старт

1. Поместите CSV файл в папку `input_data/`
2. Поместите PDF шаблон в папку `input_templates/`
3. Запустите скрипт:

```bash
# Минимальная команда (все файлы автоматически)
python gen2.py -t single -dx 10 -dy 5 -ds 15 -dc 0
```

### Основные параметры

#### Обязательные:
- `-t, --template-type` - тип шаблона: `single` или `multiple`
- `-dx, --dm-x` - X координата DataMatrix (слева сверху) в мм
- `-dy, --dm-y` - Y координата DataMatrix (слева сверху) в мм
- `-ds, --dm-size` - размер DataMatrix кода в мм

#### Необязательные файлы:
- `csv_file` - путь к CSV файлу (если не указан, ищется в `input_data/`)
- `template_pdf` - путь к PDF шаблону (если не указан, ищется в `input_templates/`)
- `output_pdf` - путь к выходному PDF (если не указан, создается в `output/`)

#### Для множественного шаблона:
- `-lh, --labels-horizontal` - количество этикеток по горизонтали
- `-lv, --labels-vertical` - количество этикеток по вертикали
- `-lw, --label-width` - ширина отдельной этикетки в мм
- `-lh2, --label-height` - высота отдельной этикетки в мм
- `-lml, --label-margin-left` - отступ слева от края страницы в мм
- `-lmt, --label-margin-top` - отступ сверху от края страницы в мм
- `-lsh, --label-spacing-horizontal` - расстояние между этикетками по горизонтали в мм
- `-lsv, --label-spacing-vertical` - расстояние между этикетками по вертикали в мм

#### Параметры CSV:
- `-dc, --datamatrix-column` - номер столбца CSV для DataMatrix (начиная с 0)

#### Текстовые поля:
- `-tc, --text-column` - номер столбца CSV для текста
- `-ts, --text-start` - начальная позиция для извлечения текста
- `-tl, --text-length` - длина извлекаемого текста
- `-tfs, --text-font-size` - размер шрифта для текста в пунктах
- `-tox, --text-offset-x` - смещение текста по X относительно DataMatrix в мм
- `-toy, --text-offset-y` - смещение текста по Y относительно DataMatrix в мм
- `-tcl, --text-color` - цвет текста

#### Дополнительные:
- `-d, --dpi` - DPI для генерации изображений (по умолчанию: 300)
- `-v, --version` - показать версию программы

### Примеры использования

#### 1. Автоматический поиск файлов
```bash
# Все файлы берутся автоматически из папок
python gen2.py -t single -dx 10 -dy 5 -ds 15 -dc 0
```

#### 2. Один шаблон на одну этикетку
```bash
python gen2.py data.csv maket.pdf output.pdf \
    -t single \
    -dx 10 \
    -dy 5 \
    -ds 15 \
    -dc 0
```

#### 3. Множественный шаблон (3x6)
```bash
python gen2.py -t multiple -lh 3 -lv 6 -dx 5 -dy 3 -ds 12 -dc 0
```

#### 4. С текстовыми полями
```bash
python gen2.py -t single -dx 10 -dy 5 -ds 15 -dc 0 \
    -tc 2 -ts 0 -tl 10 -tfs 14 -tox 20 -toy 0
```

#### 5. Полная команда с множественным шаблоном
```bash
python gen2.py data_copy.csv multi_maket.pdf out_multi_maket.pdf \
    -t multiple -lh 3 -lv 6 -lw 55 -lh2 37 -lml 22 -lmt 30 \
    -lsh 5 -lsv 3 -dx 38 -dy 15 -ds 17 -tc 0 -ts 32 -tl 10 \
    -tfs 7 -tox 1 -toy 18 -tcl black
```

## Формат CSV файла

CSV файл должен использовать разделитель табуляция. Пример:

```
0108809687640804215!	PLARECETA 1234567890	Дополнительная информация
0108809687640804215!	PLARECETA 1234567891	Дополнительная информация
0108809687640804215"	PLARECETA 1234567892	Дополнительная информация
```

## Типы шаблонов

### Single (один шаблон на этикетку)
- Каждая этикетка создается на отдельной странице
- Используется один PDF шаблон для всех этикеток
- Подходит для больших этикеток

### Multiple (несколько этикеток на шаблоне)
- Несколько этикеток размещаются на одной странице
- Автоматическое создание новых страниц при превышении лимита
- Заполнение по строкам и столбцам
- Подходит для маленьких этикеток

## Особенности

1. **Высокое качество**: DataMatrix коды генерируются в высоком разрешении
2. **Прозрачный фон**: DataMatrix коды имеют прозрачный фон для наложения на шаблоны
3. **Гибкое позиционирование**: Точное позиционирование DataMatrix по координатам
4. **Многостраничность**: Поддержка создания PDF документов с множеством страниц
5. **Автоматическое заполнение**: Этикетки заполняются по строкам и столбцам
6. **Текстовые поля**: Поддержка добавления текста из CSV с настраиваемым позиционированием
7. **Гибкое извлечение текста**: Возможность извлечения фрагментов текста
8. **Совместимость**: Работает с различными PDF шаблонами

## Зависимости

- `pylibdmtx` - для генерации DataMatrix кодов
- `qrcode` - альтернативная библиотека для кодов (если pylibdmtx недоступна)
- `reportlab` - для работы с PDF
- `PyPDF2` - для работы с PDF шаблонами
- `Pillow` - для обработки изображений

## Версии

- **main.py** - оригинальная версия
- **gen2.py v2.5** - улучшенная версия с шаблонами и автоматической организацией файлов

## Автор

Michael Bag

## Лицензия

Проект распространяется свободно для использования и модификации.